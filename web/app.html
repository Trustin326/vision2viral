<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Vision2Viral App</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>

/* ===== BASE ===== */

body{
margin:0;
font-family:Inter, system-ui;
background:#f4f7fb;
color:#0a2540;
}

/* ===== LAYOUT ===== */

.app{
display:flex;
height:100vh;
}

/* ===== SIDEBAR ===== */

.sidebar{
width:240px;
background:#0a2540;
color:white;
padding:25px;
display:flex;
flex-direction:column;
}

.logo{
font-size:22px;
font-weight:700;
margin-bottom:30px;
}

.navItem{
padding:12px;
border-radius:10px;
margin-bottom:8px;
cursor:pointer;
background:transparent;
}

.navItem:hover{
background:#173b63;
}

.navItem.active{
background:#0fb9b1;
}

/* ===== MAIN ===== */

.main{
flex:1;
display:flex;
flex-direction:column;
}

/* HEADER */

.header{
background:white;
padding:18px 30px;
display:flex;
justify-content:space-between;
box-shadow:0 3px 20px rgba(0,0,0,.05);
}

/* CONTENT */

.content{
padding:30px;
overflow:auto;
}

/* METRICS */

.metrics{
display:grid;
grid-template-columns:repeat(4,1fr);
gap:20px;
margin-bottom:25px;
}

.card{
background:white;
padding:20px;
border-radius:14px;
box-shadow:0 10px 30px rgba(0,0,0,.08);
}

/* PANELS */

.panel{
background:white;
padding:25px;
border-radius:14px;
box-shadow:0 10px 30px rgba(0,0,0,.08);
margin-bottom:20px;
}

.hidden{
display:none;
}

/* BUTTON */

.btn{
background:#0fb9b1;
border:none;
color:white;
padding:10px 18px;
border-radius:10px;
cursor:pointer;
}

</style>

</head>

<body>

<div id="loading" style="padding:40px;font-size:22px">
Loading Session...
</div>

<div id="app" class="app hidden">

<!-- SIDEBAR -->
<div class="sidebar">

<div class="logo">Vision2Viral</div>

<div class="navItem active" onclick="show('dashboard')">Dashboard</div>
<div class="navItem" onclick="show('generate')">AI Generate</div>
<div class="navItem" onclick="show('bulk')">Bulk Tools</div>
<div class="navItem" onclick="show('calendar')">Calendar</div>
<div class="navItem" onclick="show('affiliate')">Affiliate</div>
<div id="adminNav" class="navItem hidden" onclick="show('admin')">Admin</div>

</div>

<!-- MAIN -->
<div class="main">

<!-- HEADER -->
<div class="header">
<div>App Dashboard</div>
<div>
<span id="userEmail"></span>
<button class="btn" onclick="logout()">Logout</button>
</div>
</div>

<!-- CONTENT -->
<div class="content">

<!-- DASHBOARD -->
<div class="view dashboard">

<div class="metrics">
<div class="card"><h4>Generations Today</h4><h2>24</h2></div>
<div class="card"><h4>Total Generations</h4><h2>1240</h2></div>
<div class="card"><h4>Active Projects</h4><h2>8</h2></div>
<div class="card"><h4>Credits</h4><h2>980</h2></div>
</div>

<div class="panel">
<h3>Recent Activity</h3>
<ul>
<li>Generated TikTok captions</li>
<li>Created 30 day calendar</li>
<li>Uploaded bulk images</li>
</ul>
</div>

</div>

<!-- GENERATE -->
<div class="view generate hidden">
<div class="panel">
<h3>AI Content Generator</h3>
<input type="file" id="img">
<br><br>
<button class="btn" onclick="generate()">Generate Content</button>
<pre id="out"></pre>
</div>
</div>

<!-- BULK -->
<div class="view bulk hidden">
<div class="panel">
<h3>Bulk Content Tools</h3>
<p>Upload multiple images and generate content packs.</p>
</div>
</div>

<!-- CALENDAR -->
<div class="view calendar hidden">
<div class="panel">
<h3>Content Calendar Generator</h3>
<button class="btn" onclick="calendar()">Generate 30 Day Calendar</button>
<pre id="calOut"></pre>
</div>
</div>

<!-- AFFILIATE -->
<div class="view affiliate hidden">
<div class="panel">
<h3>Affiliate Dashboard</h3>
<p>Your referral stats and earnings will show here.</p>
</div>
</div>

<!-- ADMIN -->
<div class="view admin hidden">
<div class="panel">
<h3>Admin Panel</h3>
<p>Manage users, credits, plans.</p>
</div>
</div>

</div>
</div>
</div>

<script>

/* ===== SUPABASE ===== */

const supabase = window.supabase.createClient(
"https://hkahomqynwgwdsgvqejr.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhrYWhvbXF5bndnd2RzZ3ZxZWpyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NDc4MDMsImV4cCI6MjA4NjMyMzgwM30.A5WookIa6Vn1b1BDvgGtDvhXBqXP-18Kcp0KY9-T9nk"
)

/* ===== AUTH CHECK ===== */

async function init(){

let { data:{ session } } = await supabase.auth.getSession()

if(!session){
window.location.href="../login.html"
return
}

document.getElementById("userEmail").innerText =
session.user.email

await checkRole(session.user.id)

document.getElementById("loading").classList.add("hidden")
document.getElementById("app").classList.remove("hidden")

}

setTimeout(init,300)

/* ===== ROLE ===== */

async function checkRole(id){

try{
let { data } = await supabase
.from("profiles")
.select("role")
.eq("id",id)
.single()

if(data && (data.role==="admin" || data.role==="owner")){
document.getElementById("adminNav").classList.remove("hidden")
}

}catch(e){}

}

/* ===== NAV ===== */

function show(name){

document.querySelectorAll(".view").forEach(v=>{
v.classList.add("hidden")
})

document.querySelector("." + name).classList.remove("hidden")

}

/* ===== LOGOUT ===== */

async function logout(){
await supabase.auth.signOut()
window.location.href="../login.html"
}

/* ===== FEATURES ===== */

async function generate(){

let { data:{ session } } = await supabase.auth.getSession()

let res = await fetch("/api/generate",{
method:"POST",
headers:{
Authorization:"Bearer "+session.access_token,
"Content-Type":"application/json"
},
body:JSON.stringify({})
})

let json = await res.json()
document.getElementById("out").innerText =
JSON.stringify(json.output,null,2)

}

async function calendar(){

let { data:{ session } } = await supabase.auth.getSession()

let res = await fetch("/api/calendar-generate",{
method:"POST",
headers:{
Authorization:"Bearer "+session.access_token,
"Content-Type":"application/json"
},
body:JSON.stringify({})
})

let json = await res.json()
document.getElementById("calOut").innerText =
JSON.stringify(json.calendar,null,2)

}

</script>

</body>
</html>
