<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Vision2Viral Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>

/* BASE */
body{
margin:0;
font-family:Inter, system-ui;
background:#f4f7fb;
color:#0a2540;
}

/* LOADING SCREEN */
#loadingScreen{
position:fixed;
inset:0;
background:white;
display:flex;
align-items:center;
justify-content:center;
font-size:22px;
font-weight:600;
z-index:999;
}

/* HEADER */
.header{
background:linear-gradient(90deg,#0fb9b1,#0aa39c);
color:white;
padding:20px 40px;
display:flex;
justify-content:space-between;
align-items:center;
font-size:24px;
}

/* NAV */
.nav{
background:#0a2540;
padding:14px;
display:flex;
gap:10px;
}

.nav button{
background:#173b63;
border:none;
color:white;
padding:10px 18px;
border-radius:20px;
cursor:pointer;
}

/* METRICS */
.metrics{
display:flex;
gap:20px;
padding:30px;
}

.card{
background:white;
padding:25px;
border-radius:15px;
flex:1;
box-shadow:0 10px 30px rgba(0,0,0,.08);
}

/* PANELS */
.main{
display:grid;
grid-template-columns:1fr 1fr;
gap:20px;
padding:30px;
}

.panel{
background:white;
padding:30px;
border-radius:15px;
box-shadow:0 10px 30px rgba(0,0,0,.08);
}

.hidden{
display:none;
}

</style>

</head>

<body>

<div id="loadingScreen">Checking Login...</div>

<div id="appUI" style="display:none">

<!-- HEADER -->
<div class="header">
<div>Vision2Viral Dashboard</div>

<div>
<span id="userEmail"></span>
<button onclick="logout()" style="margin-left:15px">Logout</button>
</div>
</div>

<!-- NAV -->
<div class="nav">
<button onclick="showTab('dashboard')">Dashboard</button>
<button onclick="showTab('generate')">Generate</button>
<button onclick="showTab('bulk')">Bulk</button>
<button onclick="showTab('calendar')">Calendar</button>
<button onclick="showTab('affiliate')">Affiliate</button>
<button id="adminTab" class="hidden" onclick="showTab('admin')">Admin</button>
</div>

<!-- METRICS -->
<div class="metrics">
<div class="card"><h3>Generations Today</h3><h1>24</h1></div>
<div class="card"><h3>Total Generations</h3><h1>1240</h1></div>
<div class="card"><h3>Active Projects</h3><h1>12</h1></div>
</div>

<!-- MAIN PANELS -->
<div class="main">

<div class="panel tab dashboard">
<h3>Dashboard Overview</h3>
<p>Welcome to your AI Content Engine.</p>
</div>

<div class="panel tab generate">
<h3>AI Generate</h3>
<input type="file" id="img">
<button onclick="generate()">Generate</button>
<pre id="out"></pre>
</div>

<div class="panel tab bulk hidden">
<h3>Bulk Generator</h3>
<p>Upload multiple images and generate content in batch.</p>
</div>

<div class="panel tab calendar hidden">
<h3>Content Calendar</h3>
<p>Generate 30-day posting plan.</p>
<button onclick="generateCalendar()">Generate Calendar</button>
<pre id="calendarOut"></pre>
</div>

<div class="panel tab affiliate hidden">
<h3>Affiliate Dashboard</h3>
<p>Track referrals and earnings.</p>
</div>

<div class="panel tab admin hidden" id="adminPanel">
<h3>Admin / Owner Panel</h3>
<p>Manage users, credits, and plans.</p>
</div>

</div>
</div>

<script>

/* ========================= */
/* SUPABASE INIT */
/* ========================= */

const SUPABASE_URL = "https://hkahomqynwgwdsgvqejr.supabase.co"
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhrYWhvbXF5bndnd2RzZ3ZxZWpyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NDc4MDMsImV4cCI6MjA4NjMyMzgwM30.A5WookIa6Vn1b1BDvgGtDvhXBqXP-18Kcp0KY9-T9nk"

const supabase = window.supabase.createClient(
SUPABASE_URL,
SUPABASE_ANON_KEY
)

/* ========================= */
/* AUTH GUARD */
/* ========================= */

async function initAuth(){

let { data:{ session } } = await supabase.auth.getSession()

if(!session){
window.location.href = "../login.html"
return
}

/* Show email */
document.getElementById("userEmail").innerText =
session.user.email

/* ROLE CHECK */
await detectRole(session.user.id)

/* SHOW UI */
document.getElementById("loadingScreen").style.display="none"
document.getElementById("appUI").style.display="block"

}

/* ========================= */
/* ROLE DETECTION */
/* ========================= */

async function detectRole(userId){

try{

let { data } = await supabase
.from("profiles")
.select("role")
.eq("id", userId)
.single()

if(data && (data.role === "owner" || data.role === "admin")){
document.getElementById("adminTab").classList.remove("hidden")
}

}catch(e){
console.log("No role table yet â€” skipping role check")
}

}

/* ========================= */
/* LOGOUT */
/* ========================= */

async function logout(){
await supabase.auth.signOut()
window.location.href = "../login.html"
}

/* ========================= */
/* TAB SYSTEM */
/* ========================= */

function showTab(tab){

document.querySelectorAll(".tab").forEach(el=>{
el.classList.add("hidden")
})

document.querySelectorAll("." + tab).forEach(el=>{
el.classList.remove("hidden")
})

}

/* ========================= */
/* AI GENERATE */
/* ========================= */

async function generate(){

let { data:{ session } } = await supabase.auth.getSession()

let res = await fetch("/api/generate",{
method:"POST",
headers:{
"Authorization":"Bearer " + session.access_token,
"Content-Type":"application/json"
},
body:JSON.stringify({})
})

let json = await res.json()

document.getElementById("out").innerText =
JSON.stringify(json.output,null,2)

}

/* ========================= */
/* CALENDAR GENERATE */
/* ========================= */

async function generateCalendar(){

let { data:{ session } } = await supabase.auth.getSession()

let res = await fetch("/api/calendar-generate",{
method:"POST",
headers:{
"Authorization":"Bearer " + session.access_token,
"Content-Type":"application/json"
},
body:JSON.stringify({})
})

let json = await res.json()

document.getElementById("calendarOut").innerText =
JSON.stringify(json.calendar,null,2)

}

/* ========================= */
/* START */
/* ========================= */

setTimeout(initAuth,300)

</script>

</body>
</html>
